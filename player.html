<!DOCTYPE html>
<html lang="it">
<head>
  <meta charset="UTF-8">
  <title>Giocatore</title>
</head>
<body>
  <h1>ðŸ“± Giocatore</h1>
  <div id="login">
    <input type="text" id="nome" placeholder="Inserisci il tuo nome">
    <button onclick="join()">Entra</button>
  </div>
  <div id="waiting" style="display:none;">In attesa di approvazione...</div>
  <div id="quiz" style="display:none;">
    <div id="risposte"></div>
  </div>
  <div id="badge" style="display:none;"></div>

  <script src="https://cdn.socket.io/4.5.4/socket.io.min.js"></script>
  <script>
    const urlParams = new URLSearchParams(window.location.search);
    const room = urlParams.get('room');
    const socket = io('https://serata-giochi.onrender.com');
    let nome = '';

    function join() {
      nome = document.getElementById('nome').value;
      socket.emit('join-player', { room, nome });
      document.getElementById('login').style.display = 'none';
      document.getElementById('waiting').style.display = 'block';
    }

    socket.on('approved', () => {
      document.getElementById('waiting').style.display = 'none';
      document.getElementById('quiz').style.display = 'block';
    });

    socket.on('new-question', q => {
      document.getElementById('risposte').innerHTML = q.risposte.map((r, i) => 
        '<button onclick="answer(\'' + ['A','B','C','D'][i] + '\')">' + ['A','B','C','D'][i] + '</button>').join('<br>');
    });

    function answer(letter) {
      socket.emit('answer', { room, nome, risposta: letter });
    }

    socket.on('badge', msg => {
      document.getElementById('quiz').style.display = 'none';
      document.getElementById('badge').style.display = 'block';
      document.getElementById('badge').innerHTML = msg;
    });
  </script>
</body>
</html>