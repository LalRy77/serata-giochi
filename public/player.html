<!DOCTYPE html>
<html lang="it">
<head>
  <meta charset="UTF-8">
  <title>Giocatore</title>
  <link rel="icon" type="image/png" href="/favicon.png">
  <script src="https://cdn.socket.io/4.7.2/socket.io.min.js"></script>
  <style>
    body {
      margin:0; padding:0;
      background: url('/immagini/sfondoplayer.jpg') center/cover no-repeat;
      font-family:sans-serif; color:white; text-align:center;
    }
    #join, #waiting {
      position:absolute; top:50%; left:50%;
      transform:translate(-50%,-50%);
      width:90vw; max-width:400px;
    }
    #join input, #join button, #waiting p {
      width:100%; margin:.5em 0;
      font-size:46px; padding:12px; border:none; border-radius:8px;
    }
    #quiz {
      display:none;
      position:absolute; top:0; left:0;
      width:100%; height:100%;
      flex-wrap: wrap; display:flex;
      align-items:center; justify-content:center;
    }
    #quiz h2 {
      position:absolute; top:1em; width:100%;
      font-size:3em;
    }
    .col {
      flex:1 1 50%; height:50%;
      display:flex; align-items:center; justify-content:center;
      font-size:100px; cursor:pointer; border:none; color:white;
    }
    #A { background:#e74c3c }
    #B { background:#3498db }
    #C { background:#f1c40f }
    #D { background:#2ecc71 }
    #badge {
      position:absolute; bottom:1em; left:50%;
      transform:translateX(-50%);
      background:rgba(0,0,0,0.7); padding:12px 24px;
      border-radius:8px; font-size:46px;
    }
  </style>
</head>
<body>
  <div id="join">
    <h1>üéÆ Inserisci il tuo nome</h1>
    <input id="nome" placeholder="Il tuo nome">
    <button id="btnEntra">Entra</button>
  </div>
  <div id="waiting" style="display:none;">
    <p id="msg">‚è≥ In attesa di autorizzazione...</p>
  </div>
  <div id="quiz">
    <h2 id="titoloDomanda"></h2>
    <div id="A" class="col">A</div>
    <div id="B" class="col">B</div>
    <div id="C" class="col">C</div>
    <div id="D" class="col">D</div>
    <div id="badge"></div>
  </div>

  <script>
    const socket = io();
    const room = new URLSearchParams(location.search).get('room');
    let nome='', abilitato=false;

    document.getElementById('btnEntra').onclick = () => {
      const v = document.getElementById('nome').value.trim();
      if (!v) return alert('Inserisci un nome');
      nome=v;
      socket.emit('join', { room, nome });
      document.getElementById('join').style.display='none';
      document.getElementById('waiting').style.display='block';
    };

    socket.on('errore', e=>{
      alert(e);
      location.reload();
    });
    socket.on('abilitati', list => {
      if (list.includes(nome)) {
        abilitato=true;
        document.getElementById('msg').innerText='‚úÖ Abilitato! In attesa domanda...';
      }
    });

    socket.on('new-question', q=>{
      if (!abilitato) return;
      document.getElementById('waiting').style.display='none';
      document.getElementById('quiz').style.display='flex';
      document.getElementById('titoloDomanda').innerText = `Domanda ${q.numero}`;
      document.getElementById('badge').innerText = '';
    });

    ['A','B','C','D'].forEach(letter=>{
      document.getElementById(letter).onclick = ()=>{
        if (!abilitato) return;
        socket.emit('risposta',{room, risposta:letter});
        document.getElementById('badge').innerText='‚úÖ Inviata!';
      };
    });

    socket.on('badge', msg=>{
      document.getElementById('badge').innerHTML=msg;
    });
    socket.on('fine-gioco', ()=>{
      document.getElementById('badge').innerText='üéâ Fine gioco!';
    });
  </script>
</body>
</html>
