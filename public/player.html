<!DOCTYPE html>
<html lang="it">
<head>
  <meta charset="UTF-8">
  <title>Player — Serata Giochi</title>
  <link rel="icon" href="/favicon.png" type="image/png">
  <style>
    * { box-sizing: border-box; margin:0; padding:0; }
    body {
      width:100vw; height:100vh;
      background: url('/immagini/sfondoplayer.jpg') top left/cover repeat;
      font-family: sans-serif;
      display: flex; align-items: center; justify-content: center;
      color: #000;
    }
    .screen { position:absolute; top:0; left:0; right:0; bottom:0; 
      display:flex; align-items:center; justify-content:center; text-align:center; }
    .hidden { display: none; }
    h1 { font-size:50px; margin-bottom:1em; }
    input, button {
      font-size:50px; padding:.5em 1em; margin:.5em;
      border:2px solid #333; border-radius:8px;
    }
    #grid { display: grid; grid-template-columns: 1fr 1fr;
             grid-template-rows: 1fr 1fr; gap:5%; width:90%; height:90%; }
    .cell {
      display:flex; align-items:center; justify-content:center;
      background:#eee; border-radius:16px; cursor:pointer;
    }
    .cell.red    { background: #e74c3c; }
    .cell.blue   { background: #3498db; }
    .cell.yellow { background: #f1c40f; }
    .cell.green  { background: #2ecc71; }
    .cell span { font-size:150px; color:#000; user-select:none; }
  </style>
</head>
<body>

  <!-- 1. Nickname screen -->
  <div id="join" class="screen">
    <div>
      <h1>Inserisci il tuo nickname</h1>
      <input id="nome" type="text" placeholder="Il tuo nome">
      <button onclick="entra()">Entra</button>
    </div>
  </div>

  <!-- 2. In attesa abilitazione -->
  <div id="waiting-pay" class="screen hidden">
    <h1>Attendi di essere abilitato dal Tesoriere…</h1>
  </div>

  <!-- 3. In attesa start -->
  <div id="waiting-start" class="screen hidden">
    <h1>In attesa che il gioco abbia inizio!</h1>
  </div>

  <!-- 4. Domanda X -->
  <div id="question" class="screen hidden">
    <div style="width:100%;max-width:600px;">
      <h1 id="num" style="font-size:50px;margin-bottom:1rem;">Domanda</h1>
      <div id="grid">
        <div class="cell red"    onclick="invia('A')"><span>A</span></div>
        <div class="cell blue"   onclick="invia('B')"><span>B</span></div>
        <div class="cell yellow" onclick="invia('C')"><span>C</span></div>
        <div class="cell green"  onclick="invia('D')"><span>D</span></div>
      </div>
    </div>
  </div>

  <!-- 5. Risposta inviata -->
  <div id="sent" class="screen hidden">
    <h1>Risposta inviata, attendi la prossima domanda…</h1>
  </div>

  <script src="https://cdn.socket.io/4.7.2/socket.io.min.js"></script>
  <script>
    const socket = io();
    const params = new URLSearchParams(location.search);
    const room   = params.get('room');
    let nome = '';

    function showScreen(id) {
      document.querySelectorAll('.screen').forEach(el=>el.classList.add('hidden'));
      document.getElementById(id).classList.remove('hidden');
    }

    function entra() {
      nome = document.getElementById('nome').value.trim();
      if (!nome) return alert('Inserisci un nickname valido!');
      socket.emit('join', { room, nome });
      showScreen('waiting-pay');
    }

    socket.on('errore', msg => {
      alert(msg);
      showScreen('join');
    });

    socket.on('abilitati', list => {
      if (list.includes(nome)) {
        showScreen('waiting-start');
      }
    });

    socket.on('new-question', q => {
      document.getElementById('num').innerText = `Domanda ${q.numero}`;
      showScreen('question');
    });

    function invia(lettera) {
      socket.emit('risposta', { room, risposta: lettera });
      showScreen('sent');
    }

    // alla connessione ri-manda join se già inserito
    socket.on('connect', () => {
      if (nome) socket.emit('join', { room, nome });
    });
  </script>
</body>
</html>
