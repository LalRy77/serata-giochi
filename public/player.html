<!DOCTYPE html>
<html lang="it">
<head>
  <meta charset="UTF-8">
  <title>Giocatore â€” SerataÂ Giochi</title>
  <script src="https://cdn.socket.io/4.7.2/socket.io.min.js"></script>
  <style>
    body {
      margin:0;
      background:url('/immagini/sfondoplayer.jpg') center/cover no-repeat;
      color:white;
      font-family:sans-serif;
      text-align:center;
    }
    #join, #waiting, #quiz {
      padding:2em;
    }
    #join input, #join button {
      font-size:46px;
      padding:12px 24px;
      margin:0.5em;
    }
    #waiting {
      font-size:2rem;
    }
    #quiz {
      display:none;
    }
    .option-btn {
      display:block;
      width:80%;
      margin:1em auto;
      padding:1em 0;
      font-size:80px;
      border:none;
      border-radius:10px;
      color:white;
      background:#3498db;
      cursor:pointer;
    }
    #status {
      font-size:2rem;
      margin-top:1em;
    }
  </style>
</head>
<body>
  <div id="join">
    <h1>ðŸŽ® Entra nel Quiz</h1>
    <input type="text" id="nome" placeholder="Il tuo nome" />
    <button onclick="entra()">Entra</button>
  </div>

  <div id="waiting" style="display:none;">
    <p>Paga al tesoriere la partita per poter iniziare a giocare</p>
    <p>In attesa di essere abilitato dal tesoriereâ€¦</p>
  </div>

  <div id="quiz">
    <h2 id="domanda-numero">DomandaÂ â€”</h2>
    <div id="risposte">
      <button class="option-btn" data-val="A" onclick="invia('A')">A</button>
      <button class="option-btn" data-val="B" onclick="invia('B')">B</button>
      <button class="option-btn" data-val="C" onclick="invia('C')">C</button>
      <button class="option-btn" data-val="D" onclick="invia('D')">D</button>
    </div>
    <div id="status"></div>
  </div>

  <script>
    const socket = io();
    const params = new URLSearchParams(location.search);
    const room   = params.get('room');
    let   me     = '';

    function entra() {
      me = document.getElementById('nome').value.trim();
      if (!me) return alert("Inserisci il tuo nome");
      socket.emit('join', { room, nome: me });
      document.getElementById('join').style.display    = 'none';
      document.getElementById('waiting').style.display = 'block';
    }

    // Quando il tesoriere abilita...
    socket.on('abilitati', lista => {
      if (lista.includes(me)) {
        document.getElementById('waiting').style.display = 'none';
        document.getElementById('quiz').style.display    = 'block';
      }
    });

    // Quando arriva la domanda
    socket.on('new-question', q => {
      document.getElementById('domanda-numero').innerText = `Domanda ${q.numero}`;
      document.getElementById('status').innerText         = '';
    });

    function invia(lettera) {
      socket.emit('risposta', { room, risposta: lettera });
      document.getElementById('status').innerText = 'âœ… Risposta inviata! Attendi la prossima domanda';
    }

    socket.on('fine-gioco', () => {
      document.getElementById('status').innerText = 'ðŸŽ‰ Gioco terminato!';
    });

    socket.on('errore', msg => {
      alert(msg);
      // torna al nome se vuoi:
      location.reload();
    });
  </script>
</body>
</html>
