<!DOCTYPE html>
<html lang="it">
<head>
  <meta charset="UTF-8">
  <title>Serata Giochi – Gioco</title>
  <!-- favicon -->
  <link rel="icon" type="image/png" href="/favicon.png">
  <link rel="shortcut icon" type="image/png" href="/favicon.png">
  <link rel="stylesheet" href="style.css" />
  <style>
    body {
      background-image: url('/immagini/sfondo.jpg');
      background-size: cover;
      background-position: center;
      color: white;
      font-family: Arial, sans-serif;
      margin: 0;
      padding: 20px;
      text-align: center;
    }
    #controls button {
      margin: 0 10px;
      padding: 10px 20px;
      font-size: 18px;
      cursor: pointer;
    }
    #question-container {
      margin-top: 30px;
    }
    #question-text {
      font-size: 32px;
      margin-bottom: 20px;
    }
    #question-img {
      max-width: 80%;
      margin-bottom: 20px;
      border-radius: 8px;
    }
    #answer-buttons {
      display: grid;
      grid-template-columns: repeat(2, 1fr);
      grid-gap: 20px;
      margin: 0 auto;
      max-width: 600px;
    }
    .answer-btn {
      padding: 40px;
      font-size: 24px;
      color: white;
      border: none;
      border-radius: 8px;
      cursor: pointer;
    }
    .answer-btn.red    { background: #e74c3c; }
    .answer-btn.blue   { background: #3498db; }
    .answer-btn.yellow { background: #f1c40f; color: #333; }
    .answer-btn.green  { background: #2ecc71; }
  </style>
</head>
<body>

  <h1>🎲 Serata Giochi – Gioco</h1>
  <div id="controls">
    <button id="show-answer">Mostra risposta</button>
    <button id="next-question">Domanda successiva</button>
    <button id="show-leaderboard">Mostra classifica</button>
  </div>

  <div id="question-container" style="display:none;">
    <img id="question-img" src="" alt="" style="display:none;">
    <div id="question-text"></div>
    <div id="answer-buttons"></div>
  </div>

  <script src="https://cdn.socket.io/4.7.2/socket.io.min.js"></script>
  <script>
    const urlParams = new URLSearchParams(window.location.search);
    const room = urlParams.get('room');
    const quiz = urlParams.get('quiz');
    const socket = io();

    let currentQuestion = null;

    // Unisciti come host per ricevere domande & punteggi
    socket.emit('join-host', room);

    // Quando arriva una nuova domanda
    socket.on('new-question', domanda => {
      currentQuestion = domanda;
      document.getElementById('question-container').style.display = 'block';
      document.getElementById('question-text').textContent = domanda.testo;

      // immagine (se c'è)
      const imgEl = document.getElementById('question-img');
      if (domanda.immagine) {
        imgEl.src = domanda.immagine;
        imgEl.style.display = 'block';
      } else {
        imgEl.style.display = 'none';
      }

      // risposte
      const colors = ['red','blue','yellow','green'];
      const container = document.getElementById('answer-buttons');
      container.innerHTML = '';
      domanda.risposte.forEach((r, i) => {
        const btn = document.createElement('button');
        btn.className = `answer-btn ${colors[i]}`;
        btn.textContent = r;
        // di default non cliccabile: il player risponde da telefono
        btn.disabled = true;
        container.appendChild(btn);
      });
    });

    // Mostra quale risposta è corretta (e colora di grigio le altre)
    document.getElementById('show-answer').onclick = () => {
      if (!currentQuestion) return;
      const buttons = document.querySelectorAll('#answer-buttons .answer-btn');
      buttons.forEach(btn => {
        if (btn.textContent === currentQuestion.corretta) {
          btn.style.boxShadow = '0 0 0 5px white';
        } else {
          btn.style.opacity = '0.5';
        }
      });
    };

    // Chiedi al server la domanda successiva
    document.getElementById('next-question').onclick = () => {
      socket.emit('next-question', room);
    };

    // Mostra la classifica (ricevuta via socket)
    document.getElementById('show-leaderboard').onclick = () => {
      socket.emit('get-leaderboard', room);
    };

    // Ricevi e visualizza la classifica
    socket.on('leaderboard', classifica => {
      alert(
        '🏆 CLASSIFICA 🏆\n\n' +
        classifica
          .map((p,i) => `${i+1}. ${p.nome} – ${p.punti} pt`)
          .slice(0,10)
          .join('\n')
      );
    });

    // Se il server conferma che non ci sono più domande
    socket.on('fine-gioco', punteggi => {
      alert('🎉 Gioco terminato!');
    });
  </script>

</body>
</html>
