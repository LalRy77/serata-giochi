<!DOCTYPE html>
<html lang="it">
<head>
  <meta charset="UTF-8">
  <title>Host — Serata Giochi</title>
  <link rel="icon" href="/favicon.png" type="image/png">
  <script src="https://cdn.socket.io/4.7.2/socket.io.min.js"></script>
  <style>
    body {
      margin:0; padding:20px;
      font-family:sans-serif;
      background:#222; color:#fff;
    }
    #controls button {
      font-size:1.5rem; margin:0.5em;
      padding:0.5em 1em; border:none; border-radius:5px;
      cursor:pointer;
    }
    #domanda-container {
      text-align:center; margin-top:2em;
    }
    #domanda-container img {
      max-width:80%; border-radius:10px;
    }
    #domanda-testo {
      font-size:2.5rem; margin:1em 0;
    }
    #risposta-giusta {
      font-size:2rem; color:#2ecc71; margin-top:1em;
    }
    #classifica {
      margin-top:2em;
      font-size:1.2rem;
      text-align:left;
      max-width:400px; margin:auto;
    }
  </style>
</head>
<body>
  <div id="controls">
    <button id="showAnswer">Mostra risposta</button>
    <button id="nextQuestion">Domanda successiva</button>
    <button id="showRank">Classifica</button>
  </div>

  <div id="domanda-container">
    <h1 id="numeroDomanda">—</h1>
    <img id="imgDomanda" src="" alt="">
    <p id="domanda-testo">In attesa di iniziare…</p>
    <p id="risposta-giusta"></p>
  </div>

  <div id="classifica" style="display:none;"></div>

  <script>
    const socket = io();
    const params = new URLSearchParams(location.search);
    const room  = params.get('room');
    const quiz  = params.get('quiz');

    // dopo redirect da host.html, emettiamo start-game
    socket.emit('start-game', room);

    let ultima = null;  // mantiene l’ultima domanda
    socket.on('new-question', q=>{
      ultima = q;
      document.getElementById('classifica').style.display='none';
      document.getElementById('risposta-giusta').innerText='';
      document.getElementById('numeroDomanda').innerText = `Domanda ${q.numero}`;
      document.getElementById('imgDomanda').src = q.immagine;
      document.getElementById('domanda-testo').innerText = q.testo;
    });

    document.getElementById('showAnswer').onclick = ()=>{
      if(!ultima) return;
      document.getElementById('risposta-giusta')
        .innerText = `Risposta giusta: ${ultima.corretta}`;
    };

    document.getElementById('nextQuestion').onclick = ()=>{
      socket.emit('start-game', room);  // invia di nuovo per far partire la prossima
    };

    document.getElementById('showRank').onclick = ()=>{
      socket.emit('get-ranking', room);
    };

    socket.on('ranking', classifica=>{
      const div = document.getElementById('classifica');
      div.innerHTML = '<h2>Classifica</h2>' + classifica.map((e,i)=>
        `<p>${i+1}. ${e.nome} — ${e.punti} punti</p>`
      ).join('');
      div.style.display = 'block';
    });
  </script>
</body>
</html>
