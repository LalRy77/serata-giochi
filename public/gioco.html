<!DOCTYPE html>
<html lang="it">
<head>
  <meta charset="UTF-8">
  <title>Host — Serata Giochi</title>
  <script src="https://cdn.socket.io/4.7.2/socket.io.min.js"></script>
  <style>
    body { margin:0; background:#111; color:#fff; font-family:sans-serif; text-align:center; }
    #media img, #media video { max-width:80%; max-height:60vh; margin-top:1em; }
    #question { display:none; }
    #question h1 { font-size:3rem; margin:1em 0; }
    #question img { max-width:60%; border-radius:10px; margin-bottom:1em; }
    #controls { margin:1em; }
    #controls button { font-size:1.2rem; padding:.5em 1em; margin:0 .5em; }
  </style>
</head>
<body>
  <div id="media">
    <!-- intro image/video se vorrai -->
  </div>
  <div id="question">
    <h1 id="num">Domanda —</h1>
    <img id="qImg" src="" alt="">
    <p id="qText" style="font-size:2rem; margin:1em;"></p>
  </div>
  <div id="controls">
    <button onclick="showAnswer()">Mostra risposta</button>
    <button onclick="nextQ()">Domanda successiva</button>
    <button onclick="getRank()">Classifica</button>
  </div>
  <div id="ranking" style="display:none; margin:2em;"></div>

  <script>
    const socket = io();
    const p      = new URLSearchParams(location.search);
    const room   = p.get('room');

    // appena apro, mi iscrivo come host
    socket.emit('join-host', room);

    // quando arriva la domanda
    socket.on('new-question', q => {
      document.getElementById('media').innerHTML   = '';
      document.getElementById('question').style.display = 'block';
      document.getElementById('num').innerText    = `Domanda ${q.numero}`;
      document.getElementById('qImg').src         = q.immagine;
      document.getElementById('qText').innerText  = q.testo;
      document.getElementById('ranking').style.display = 'none';
    });

    function showAnswer() {
      socket.emit('show-answer', room);
    }
    socket.on('answer', text => {
      alert(`Risposta esatta: ${text}`);
    });

    function nextQ() {
      socket.emit('start-game', room);
    }

    function getRank() {
      socket.emit('get-ranking', room);
    }
    socket.on('ranking', arr => {
      const r = document.getElementById('ranking');
      r.style.display = 'block';
      r.innerHTML = '<h2>Classifica</h2>' +
        arr.map((p,i)=>`<p>${i+1}. ${p.nome} — ${p.punti} pt</p>`).join('');
    });
  </script>
</body>
</html>
