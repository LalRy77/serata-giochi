<!DOCTYPE html>
<html lang="it">
<head>
  <meta charset="UTF-8">
  <title>Serata Giochi – Host</title>
  <link rel="icon" type="image/png" href="/favicon.png">
  <style>
    /* tuo CSS esistente... */
  </style>
</head>
<body>
  <div class="overlay">
    <h1>🎉 Serata Giochi</h1>
    <h2>🧑‍🏫 Stanza Host</h2>
    <div id="qrcode"></div>
    <div id="codiceStanza"></div>
    <h3>👥 Giocatori pronti:</h3>
    <ul id="giocatoriPronti"></ul>
    <button id="startBtn">Inizia il Gioco</button>
  </div>

  <script src="https://cdn.jsdelivr.net/npm/qrcode/build/qrcode.min.js"></script>
  <script src="https://cdn.socket.io/4.3.2/socket.io.min.js"></script>
  <script>
    const urlParams = new URLSearchParams(window.location.search);
    const room = urlParams.get('room');
    const quiz = urlParams.get('quiz');
    const socket = io();

    // QR + codice stanza
    document.getElementById('codiceStanza').textContent = room;
    const urlPlayer = `${window.location.origin}/player.html?room=${room}`;
    QRCode.toCanvas(document.createElement('canvas'), urlPlayer, (_, c) => document.getElementById('qrcode').appendChild(c));

    // join-host per ricevere abilitati/online
    socket.emit('join-host', room);

    let abilitati = [], online = {};
    socket.on('abilitati', a => {
      abilitati = a;
      renderList();
    });
    socket.on('online', o => {
      online = o;
      renderList();
    });

    function renderList() {
      const ul = document.getElementById('giocatoriPronti');
      ul.innerHTML = '';
      abilitati.forEach(n=> {
        const li = document.createElement('li');
        li.textContent = (online[n] ? '🟢 ' : '🔴 ') + n;
        ul.appendChild(li);
      });
    }

    document.getElementById('startBtn').onclick = () => {
      // apri la pagina host/quiz (non la player)
      window.location.href = `/gioco.html?room=${room}&quiz=${quiz}`;
    };
  </script>
</body>
</html>
