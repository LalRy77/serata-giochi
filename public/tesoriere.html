<script>
  const socket = io();
  let room = '';
  let abilitati = [];
  let onlineState = {};

  function entra() {
    room = document.getElementById('room').value.toUpperCase().trim();
    if (!room) return alert("Inserisci un codice stanza valido");

    document.getElementById('inizio').style.display = 'none';
    document.getElementById('abilita').style.display = 'block';

    socket.emit('join-tesoriere', room);
    console.log("Tesoriere entra nella stanza:", room);
  }

  function aggiornaLista(lista) {
    const div = document.getElementById('giocatori');
    const msg = document.getElementById('messaggio-vuoto');
    div.innerHTML = '';

    if (!lista || lista.length === 0) {
      msg.style.display = 'block';
      return;
    }

    msg.style.display = 'none';

    lista.forEach(nome => {
      const stato = onlineState[nome] ? 'ðŸŸ¢' : 'ðŸ”´';
      const btn = document.createElement('button');

      if (abilitati.includes(nome)) {
        btn.innerText = `${stato} âŒ Disabilita ${nome}`;
        btn.onclick = () => {
          socket.emit('disabilita', { room, nome });
          abilitati = abilitati.filter(n => n !== nome);
          aggiornaLista(lista);
        };
      } else {
        btn.innerText = `${stato} âœ… Abilita ${nome}`;
        btn.onclick = () => {
          socket.emit('abilita', { room, nome });
          abilitati.push(nome);
          aggiornaLista(lista);
        };
      }
      div.appendChild(btn);
    });
  }

  socket.on('players', lista => {
    aggiornaLista(lista);
  });

  socket.on('abilitati', lista => {
    abilitati = lista;
    aggiornaLista(Object.keys(onlineState));
  });

  socket.on('online', stato => {
    onlineState = stato;
    aggiornaLista(Object.keys(stato));
  });

  socket.on('errore', msg => {
    alert(msg);
  });
</script>
